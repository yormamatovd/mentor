<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<StackPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="org.algo.mentor.controllers.LessonsController"
           stylesheets="@../styles/custom.css">

    <!-- Guruh tanlash oynasi -->
    <VBox fx:id="groupSelectionView" spacing="20.0" style="-fx-background-color: #f8f9fc;">
        <padding>
            <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
        </padding>
        <VBox spacing="5.0">
            <Label text="Darslar" style="-fx-font-size: 24; -fx-font-weight: bold; -fx-text-fill: #2d3748;"/>
            <Label text="Dars o'tish uchun guruhni tanlang" style="-fx-font-size: 13; -fx-text-fill: #718096;"/>
        </VBox>
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent; -fx-background: transparent; -fx-border-color: transparent;">
            <FlowPane fx:id="groupsFlowPane" hgap="20.0" vgap="20.0">
                <padding>
                    <Insets bottom="10.0" left="5.0" right="5.0" top="10.0" />
                </padding>
            </FlowPane>
        </ScrollPane>
    </VBox>

    <!-- Dars tarixi oynasi -->
    <VBox fx:id="lessonHistoryView" spacing="20.0" style="-fx-background-color: #f8f9fc;" visible="false">
        <padding>
            <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
        </padding>
        <HBox alignment="CENTER_LEFT" spacing="20.0">
            <Button text="← Orqaga" onAction="#onBackToGroups" prefWidth="150.0" styleClass="btn" style="-fx-background-color: #edf2f7; -fx-text-fill: #4a5568;"/>
            <VBox spacing="2.0">
                <Label fx:id="historyGroupTitleLabel" text="Guruh nomi" style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #2d3748;"/>
                <Label text="Darslar tarixi" style="-fx-font-size: 13; -fx-text-fill: #718096;"/>
            </VBox>
        </HBox>
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent; -fx-background: transparent; -fx-border-color: transparent;">
            <VBox fx:id="historyRowsContainer" spacing="10" style="-fx-padding: 5;"/>
        </ScrollPane>
    </VBox>

    <!-- Dars tafsilotlari oynasi (Asosiy ishchi oyna) -->
    <VBox fx:id="lessonDetailView" spacing="20.0" style="-fx-background-color: #f1f5f9;" visible="false">
        <padding>
            <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
        </padding>

        <!-- Yuqori panel (Sarlavha va boshqaruv) -->
        <HBox alignment="CENTER_LEFT" spacing="15.0">
            <Button text="← Orqaga" onAction="#onBackToHistoryOrGroups" prefWidth="120.0" styleClass="btn" style="-fx-background-color: #e2e8f0;"/>
            <VBox HBox.hgrow="ALWAYS">
                <Label fx:id="groupTitleLabel" text="Guruh nomi" style="-fx-font-size: 22; -fx-font-weight: bold; -fx-text-fill: #1e293b;"/>
                <Label fx:id="dateLabel" text="Sana" style="-fx-font-size: 14; -fx-text-fill: #64748b;"/>
            </VBox>
            
            <HBox spacing="10.0" alignment="CENTER_RIGHT">
                <Button fx:id="editButton" text="Tahrirlash" onAction="#onEditLesson" styleClass="btn" style="-fx-background-color: #dbeafe; -fx-text-fill: #1e40af;"/>
                <Label fx:id="statusLabel" text="Barcha o'zgarishlar saqlandi" style="-fx-font-size: 12; -fx-text-fill: #10b981; -fx-font-style: italic;"/>
                <Button fx:id="deleteButton" text="Darsni o'chirish" onAction="#onDeleteLesson" styleClass="btn" style="-fx-background-color: #fee2e2; -fx-text-fill: #ef4444;"/>
            </HBox>
        </HBox>

        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent; -fx-background: transparent;" hbarPolicy="NEVER" pannable="true">
            <VBox spacing="20.0">
                <!-- 1. DAVOMAT BO'LIMI (Har doim ochiq) -->
                <VBox spacing="15.0" styleClass="card">
                    <Label text="Davomat" styleClass="card-title" />
                    <FlowPane fx:id="attendanceFlowPane" hgap="15.0" vgap="15.0" prefWrapLength="1000.0" />
                </VBox>

                <!-- Boshqaruv tugmalari (Bo'limlarni ochish uchun) -->
                <HBox fx:id="actionButtonsBar" spacing="15.0" alignment="CENTER_LEFT">
                    <Button text="+ Vazifani tekshirish" onAction="#onShowHomework" styleClass="btn" style="-fx-background-color: #dcfce7; -fx-text-fill: #166534; -fx-font-weight: bold;"/>
                    <Button text="+ Yangi test o'tkazish" onAction="#onAddNewTest" styleClass="btn" style="-fx-background-color: #dbeafe; -fx-text-fill: #1e40af; -fx-font-weight: bold;"/>
                    <Button text="+ Yangi savollar o'tkazish" onAction="#onAddNewQuestion" styleClass="btn" style="-fx-background-color: #fef9c3; -fx-text-fill: #854d0e; -fx-font-weight: bold;"/>
                </HBox>

                <!-- 2. VAZIFA BO'LIMI -->
                <VBox fx:id="homeworkSection" spacing="15.0" styleClass="card" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT">
                        <HBox alignment="CENTER_LEFT" onMouseClicked="#onToggleHomework" style="-fx-cursor: hand;" HBox.hgrow="ALWAYS" spacing="10">
                            <Label text="Uy vazifasi baholari" styleClass="card-title" />
                            <StackPane styleClass="btn-toggle">
                                <Label fx:id="homeworkCollapseIcon" text="▲" styleClass="icon"/>
                            </StackPane>
                            <Region HBox.hgrow="ALWAYS" />
                        </HBox>
                        <Region prefWidth="15" />
                        <Button fx:id="homeworkSortBtn" text="⇅ Tartiblash" onAction="#onSortHomework" styleClass="btn-sort" />
                        <Region prefWidth="15" />
                        <Button fx:id="homeworkHideBtn" text="✕" onAction="#onHideHomework" style="-fx-background-color: #fee2e2; -fx-text-fill: #ef4444; -fx-font-weight: bold; -fx-background-radius: 4; -fx-cursor: hand;"/>
                    </HBox>
                    <FlowPane fx:id="homeworkFlowPane" hgap="15.0" vgap="15.0" />
                </VBox>

                <!-- 3. TESTLAR BO'LIMI (Dinamik bloklar uchun konteyner) -->
                <VBox fx:id="testSection" spacing="15.0" styleClass="card" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <HBox alignment="CENTER_LEFT" onMouseClicked="#onToggleTest" style="-fx-cursor: hand;" HBox.hgrow="ALWAYS" spacing="10">
                            <Label text="Testlar" styleClass="card-title" />
                            <StackPane styleClass="btn-toggle">
                                <Label fx:id="testCollapseIcon" text="▲" styleClass="icon"/>
                            </StackPane>
                        </HBox>
                        <Region HBox.hgrow="ALWAYS" />
                    </HBox>
                    <VBox fx:id="testSessionsContainer" spacing="20.0" />
                </VBox>

                <!-- 4. SAVOLLAR BO'LIMI (Dinamik bloklar uchun konteyner) -->
                <VBox fx:id="questionSection" spacing="15.0" styleClass="card" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <HBox alignment="CENTER_LEFT" onMouseClicked="#onToggleQuestion" style="-fx-cursor: hand;" HBox.hgrow="ALWAYS" spacing="10">
                            <Label text="Savollar" styleClass="card-title" />
                            <StackPane styleClass="btn-toggle">
                                <Label fx:id="questionCollapseIcon" text="▲" styleClass="icon"/>
                            </StackPane>
                        </HBox>
                        <Region HBox.hgrow="ALWAYS" />
                    </HBox>
                    <VBox fx:id="questionSessionsContainer" spacing="20.0" />
                </VBox>
            </VBox>
        </ScrollPane>
    </VBox>
</StackPane>
