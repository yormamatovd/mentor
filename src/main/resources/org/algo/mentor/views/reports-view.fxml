<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>

<VBox spacing="20.0" style="-fx-background-color: #f8f9fc;" xmlns="http://javafx.com/javafx" xmlns:fx="http://javafx.com/fxml" 
      fx:controller="org.algo.mentor.controllers.ReportsController"
      stylesheets="@../styles/custom.css">
    <padding>
        <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
    </padding>

    <HBox alignment="CENTER_LEFT" spacing="20.0">
        <VBox spacing="5.0">
            <Label text="Hisobotlar va Statistika" style="-fx-font-size: 24; -fx-font-weight: bold; -fx-text-fill: #2d3748;"/>
            <Label text="O'quv jarayoni va natijalar tahlili" style="-fx-text-fill: #718096; -fx-font-size: 13;"/>
        </VBox>
        <Region HBox.hgrow="ALWAYS" />
        <HBox spacing="15">
            <VBox styleClass="mini-stat-card" style="-fx-background-color: #ebf8ff; -fx-padding: 10 20; -fx-background-radius: 10;">
                <Label text="Jami O'quvchilar" style="-fx-text-fill: #3182ce; -fx-font-size: 11;"/>
                <Label fx:id="totalStudentsLabel" text="0" style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #2c5282;"/>
            </VBox>
            <VBox styleClass="mini-stat-card" style="-fx-background-color: #f0fff4; -fx-padding: 10 20; -fx-background-radius: 10;">
                <Label text="Jami Guruhlar" style="-fx-text-fill: #38a169; -fx-font-size: 11;"/>
                <Label fx:id="totalGroupsLabel" text="0" style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #276749;"/>
            </VBox>
            <VBox styleClass="mini-stat-card" style="-fx-background-color: #fff5f5; -fx-padding: 10 20; -fx-background-radius: 10;">
                <Label text="O'rtacha Davomat" style="-fx-text-fill: #e53e3e; -fx-font-size: 11;"/>
                <Label fx:id="avgAttendanceLabel" text="0%" style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #9b2c2c;"/>
            </VBox>
        </HBox>
    </HBox>

    <TabPane tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS" styleClass="reports-tab-pane">
        <!-- Guruhlar bo'yicha faollik -->
        <Tab text="Guruhlar faolligi">
            <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: #f8f9fc;">
                <VBox spacing="20" style="-fx-padding: 20;">
                    <HBox spacing="20">
                        <VBox styleClass="card" HBox.hgrow="ALWAYS" spacing="10">
                            <Label text="Guruhlar statistikasi" styleClass="card-title" style="-fx-font-size: 16;"/>
                            <TableView fx:id="groupStatsTable" prefHeight="300" styleClass="modern-table">
                                <columns>
                                    <TableColumn fx:id="groupNameCol" text="Guruh nomi" prefWidth="200"/>
                                    <TableColumn fx:id="groupStudentCountCol" text="O'quvchilar" prefWidth="100"/>
                                    <TableColumn fx:id="groupAvgAttCol" text="Davomat (%)" prefWidth="120"/>
                                    <TableColumn fx:id="groupAvgScoreCol" text="O'zlashtirish" prefWidth="120"/>
                                </columns>
                            </TableView>
                        </VBox>
                        
                        <VBox styleClass="card" prefWidth="650" spacing="10">
                            <Label text="O'quvchilar taqsimoti" styleClass="card-title" style="-fx-font-size: 16;"/>
                            <PieChart fx:id="groupDistributionChart" prefHeight="500" legendSide="BOTTOM" labelsVisible="true" />
                        </VBox>
                    </HBox>
                    
                    <VBox styleClass="card" spacing="10">
                        <Label text="Guruhlar o'rtacha ko'rsatkichlari" styleClass="card-title" style="-fx-font-size: 16;"/>
                        <BarChart fx:id="groupComparisonChart" prefHeight="300" animated="false">
                            <xAxis><CategoryAxis fx:id="groupComparisonXAxis" label="Guruhlar"/></xAxis>
                            <yAxis><NumberAxis label="Ko'rsatkich" lowerBound="0" upperBound="100" tickUnit="20"/></yAxis>
                        </BarChart>
                    </VBox>
                </VBox>
            </ScrollPane>
        </Tab>

        <!-- O'quvchilar bo'yicha faollik -->
        <Tab text="O'quvchilar faolligi">
            <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: #f8f9fc;">
                <VBox spacing="15" style="-fx-padding: 20;">
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label text="Guruhni tanlang:" style="-fx-font-weight: bold; -fx-text-fill: #4a5568;"/>
                        <ComboBox fx:id="groupFilterCombo" promptText="Guruh tanlang..." prefWidth="250" styleClass="form-control"/>
                    </HBox>
                    <TableView fx:id="studentStatsTable" prefHeight="600" styleClass="modern-table">
                        <columns>
                            <TableColumn fx:id="studentRankCol" text="Reyting" prefWidth="80"/>
                            <TableColumn fx:id="studentNameCol" text="F.I.SH" prefWidth="250"/>
                            <TableColumn fx:id="studentAttRateCol" text="Davomat (%)" prefWidth="120"/>
                            <TableColumn fx:id="studentMissedCol" text="Qoldirilgan" prefWidth="100"/>
                            <TableColumn fx:id="studentAvgScoreCol" text="O'zlashtirish" prefWidth="120"/>
                        </columns>
                    </TableView>
                </VBox>
            </ScrollPane>
        </Tab>

        <!-- Shaxsiy statistika -->
        <Tab text="Shaxsiy statistika">
            <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: #f8f9fc;">
                <VBox spacing="20" style="-fx-padding: 20;">
                    <VBox spacing="10">
                        <HBox spacing="15" alignment="BOTTOM_LEFT">
                            <VBox spacing="5" prefWidth="350">
                                <Label text="O'quvchini tanlang:" style="-fx-font-weight: bold; -fx-text-fill: #4a5568; -fx-font-size: 12;"/>
                                <TextField fx:id="studentSearchField" promptText="O'quvchi ismi yoki telefonini kiriting..." styleClass="form-control"/>
                            </VBox>
                            <VBox spacing="5">
                                <Label text=" " style="-fx-font-size: 12;"/>
                                <Button text="Qidirish" onAction="#onSearchStudentClick" styleClass="btn, btn-primary" style="-fx-padding: 8 20;"/>
                            </VBox>
                            <VBox spacing="5" prefWidth="150">
                                <Label text="Dan:" style="-fx-font-weight: bold; -fx-text-fill: #4a5568; -fx-font-size: 12;"/>
                                <DatePicker fx:id="dateFromPicker" promptText="Sanani tanlang"/>
                            </VBox>
                            <VBox spacing="5" prefWidth="150">
                                <Label text="Gacha:" style="-fx-font-weight: bold; -fx-text-fill: #4a5568; -fx-font-size: 12;"/>
                                <DatePicker fx:id="dateToPicker" promptText="Sanani tanlang"/>
                            </VBox>
                            <Region HBox.hgrow="ALWAYS" />
                            <VBox spacing="5" alignment="TOP_RIGHT">
                                <Label text=" " style="-fx-font-size: 12;"/>
                                <HBox spacing="5" alignment="CENTER_RIGHT">
                                    <Label fx:id="personalExportStatusLabel" visible="false" managed="false" style="-fx-font-size: 12; -fx-padding: 8; -fx-background-radius: 5;"/>
                                    <Button fx:id="exportPersonalPdfBtn" text="Eksport PDF" onAction="#onExportPersonalPdfClick" disable="true" styleClass="btn, btn-primary" style="-fx-padding: 8 20;"/>
                                </HBox>
                            </VBox>
                        </HBox>
                        <ListView fx:id="studentSearchResultsList" prefHeight="150" visible="false" managed="false" style="-fx-background-radius: 8; -fx-border-radius: 8;"/>
                    </VBox>
                    
                    <GridPane hgap="20" vgap="20">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="33"/>
                        <ColumnConstraints percentWidth="33"/>
                        <ColumnConstraints percentWidth="34"/>
                    </columnConstraints>
                    
                    <VBox styleClass="stat-card" style="-fx-background-color: #ebf8ff; -fx-padding: 20; -fx-background-radius: 10;">
                        <Label text="Umumiy Reyting" style="-fx-text-fill: #3182ce; -fx-font-size: 14;"/>
                        <Label fx:id="individualRankLabel" text="0" style="-fx-font-size: 32; -fx-font-weight: bold; -fx-text-fill: #2c5282;"/>
                    </VBox>
                    
                    <VBox GridPane.columnIndex="1" styleClass="stat-card" style="-fx-background-color: #f0fff4; -fx-padding: 20; -fx-background-radius: 10;">
                        <Label text="O'zlashtirish" style="-fx-text-fill: #38a169; -fx-font-size: 14;"/>
                        <Label fx:id="individualAvgScoreLabel" text="0.0" style="-fx-font-size: 32; -fx-font-weight: bold; -fx-text-fill: #276749;"/>
                    </VBox>
                    
                    <VBox GridPane.columnIndex="2" styleClass="stat-card" style="-fx-background-color: #fffaf0; -fx-padding: 20; -fx-background-radius: 10;">
                        <Label text="Davomat Ko'rsatkichi" style="-fx-text-fill: #dd6b20; -fx-font-size: 14;"/>
                        <Label fx:id="individualAttRateLabel" text="0%" style="-fx-font-size: 32; -fx-font-weight: bold; -fx-text-fill: #9c4221;"/>
                    </VBox>
                </GridPane>

                <HBox spacing="20" VBox.vgrow="ALWAYS">
                    <VBox HBox.hgrow="ALWAYS" spacing="15">
                        <VBox styleClass="card" VBox.vgrow="ALWAYS" spacing="10">
                            <Label text="Darslar bo'yicha batafsil" styleClass="card-title" style="-fx-font-size: 16;"/>
                            <TableView fx:id="individualAttTable" VBox.vgrow="ALWAYS" styleClass="modern-table">
                                <columns>
                                    <TableColumn fx:id="attDateCol" text="Sana" prefWidth="180"/>
                                    <TableColumn fx:id="attStatusCol" text="Holati" prefWidth="120"/>
                                    <TableColumn fx:id="scoreTypeCol" text="Topsiriq" prefWidth="140"/>
                                    <TableColumn fx:id="attTotalCol" text="Jami" prefWidth="80"/>
                                    <TableColumn fx:id="attResultCol" text="Topdi" prefWidth="80"/>
                                </columns>
                            </TableView>
                        </VBox>
                    </VBox>
                    
                    <VBox prefWidth="450" spacing="20">
                        <VBox styleClass="card" spacing="10">
                            <Label text="Davomat taqsimoti" styleClass="card-title" style="-fx-font-size: 16;"/>
                            <PieChart fx:id="individualAttendancePie" prefHeight="250" legendVisible="true" />
                        </VBox>
                        
                        <VBox styleClass="card" VBox.vgrow="ALWAYS" spacing="10">
                            <Label text="O'zlashtirish grafigi" styleClass="card-title" style="-fx-font-size: 16;"/>
                            <LineChart fx:id="performanceChart" createSymbols="true" legendVisible="true" animated="false">
                                <xAxis><CategoryAxis label="Sana"/></xAxis>
                                <yAxis><NumberAxis label="Ball" lowerBound="0" upperBound="100" tickUnit="10"/></yAxis>
                            </LineChart>
                        </VBox>
                    </VBox>
                </HBox>
            </VBox>
            </ScrollPane>
        </Tab>
    </TabPane>
</VBox>
