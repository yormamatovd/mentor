name: Windows Build

on:
  # Trigger manually from GitHub Actions tab
  workflow_dispatch:
  
  # Or trigger on push to specific branches
  # push:
  #   branches:
  #     - main
  #     - release/*

jobs:
  build-windows:
    name: Build Windows Installer
    runs-on: windows-latest
    
    steps:
      # Checkout repository
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Setup Java 17
      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'
      
      # Verify Java installation
      - name: Verify Java
        run: |
          java -version
          echo "JAVA_HOME: $env:JAVA_HOME"
      
      # Build Windows installer
      - name: Build Windows .exe installer
        run: |
          powershell -ExecutionPolicy Bypass -File .\build-scripts\build-windows.ps1 -SkipTests
      
      # Get installer info
      - name: Get installer info
        id: installer
        run: |
          $installer = Get-ChildItem -Path "target\installer" -Filter "*.msi" | Select-Object -First 1
          echo "installer_name=$($installer.Name)" >> $env:GITHUB_OUTPUT
          echo "installer_path=$($installer.FullName)" >> $env:GITHUB_OUTPUT
          echo "installer_size=$([math]::Round($installer.Length / 1MB, 2)) MB" >> $env:GITHUB_OUTPUT
      
      # Upload installer as artifact
      - name: Upload Windows installer
        uses: actions/upload-artifact@v4
        with:
          name: mentor-windows-installer
          path: target/installer/*.msi
          retention-days: 30
      
      # Display summary
      - name: Build summary
        run: |
          echo "### âœ… Windows Build Complete!" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "**Installer:** ${{ steps.installer.outputs.installer_name }}" >> $env:GITHUB_STEP_SUMMARY
          echo "**Size:** ${{ steps.installer.outputs.installer_size }}" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "Download from the Artifacts section above." >> $env:GITHUB_STEP_SUMMARY
